<%- include('partials/header') %>

<div class="container mt-4">
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h4 class="mb-3">Add New Expense</h4>

          <form action="/add-expense" method="POST">
            <div class="mb-3">
              <input
                type="text"
                name="description"
                class="form-control"
                placeholder="Description"
                required
              />
            </div>

            <div class="mb-3">
              <input
                type="number"
                name="amount"
                class="form-control"
                placeholder="Amount"
                step="0.01"
                min="0"
                required
              />
            </div>

            <div class="mb-3">
              <select name="category" class="form-select" required>
                <option value="" disabled selected>Select category</option>
                <% (categories || []).forEach(c => { %>
                  <option value="<%= c.name %>"><%= c.name %></option>
                <% }) %>
              </select>
            </div>

            <button type="submit" class="btn btn-primary w-100">Save</button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h4 class="mb-3">Expenses</h4>

          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Desc</th>
                  <th>Category</th>
                  <th class="text-end">Amount</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>

              <tbody>
                <% if (!expenses || expenses.length === 0) { %>
                  <tr>
                    <td colspan="5" class="text-center text-muted py-4">
                      No expenses yet.
                    </td>
                  </tr>
                <% } else { %>
                  <% expenses.forEach(e => { %>
                    <tr>
                      <td><%= e.date ? new Date(e.date).toDateString() : "—" %></td>

                      <td>
                        <%= (e.description && String(e.description).trim() !== "")
                          ? e.description
                          : "—" %>
                      </td>

                      <td>
                        <span class="badge bg-secondary">
                          <%= e.category || "Other" %>
                        </span>
                      </td>

                      <td class="text-end">
                        $<%= Number(e.amount || 0).toFixed(2) %>
                      </td>

                      <td class="text-end">
                        <a
                          href="/delete-expense/<%= e._id %>"
                          class="btn btn-sm btn-outline-danger"
                        >
                          Delete
                        </a>
                      </td>
                    </tr>
                  <% }) %>
                <% } %>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
