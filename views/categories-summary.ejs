<%- include('partials/header') %>



<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Category Summary</h3>
    <a class="btn btn-outline-secondary" href="/categories">Back to Manage</a>
  </div>

  <div class="card p-4 shadow-sm border-0 mb-4">
    <h5 class="mb-3">Filter</h5>

    <form method="GET" action="/categories-summary" class="row g-2 align-items-end">
      <div class="col-md-3">
        <label class="form-label">Month</label>
        <input class="form-control" type="number" name="month" min="1" max="12" value="<%= month %>">
      </div>

      <div class="col-md-3">
        <label class="form-label">Year</label>
        <input class="form-control" type="number" name="year" value="<%= year %>">
      </div>

      <div class="col-md-3">
        <button class="btn btn-primary w-100">Apply</button>
      </div>
    </form>

    <hr>
    <h4>Total: <span class="text-success">$<%= grandTotal.toFixed(2) %></span></h4>
  </div>

  <div class="card p-4 shadow-sm border-0">
    <h5 class="mb-3">Breakdown</h5>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Category</th>
            <th>Total</th>
            <th>Monthly Limit</th>
            <th>Status</th>
          </tr>
        </thead>

        <tbody>
          <% if (!categories || categories.length === 0) { %>
            <tr>
              <td colspan="4" class="text-muted">No expenses found for this month.</td>
            </tr>
          <% } else { %>
            <% categories.forEach(c => { 
                 const limit = Number(c.monthlyLimit || 0);
                 const total = Number(c.total || 0);
                 const over = limit > 0 && total > limit;
            %>
              <tr>
                <td><span class="badge bg-secondary"><%= c.name %></span></td>
                <td>$<%= total.toFixed(2) %></td>
                <td>
                  <%= limit > 0 ? ('$' + limit.toFixed(2)) : 'â€”' %>
                </td>
                <td>
                  <% if (limit === 0) { %>
                    <span class="text-muted">No limit</span>
                  <% } else if (over) { %>
                    <span class="badge bg-danger">Over limit</span>
                  <% } else { %>
                    <span class="badge bg-success">Within limit</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

</div>


</body></html>
<%- include('partials/footer') %>
